<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="screen-orientation" content="landscape">
  <meta name="theme-color" content="#1a1a3e">
  <title>Christmas Dash!</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    html, body, #root {
      width: 100%;
      height: 100%;
      overflow: hidden;
      position: fixed;
      background: #1a1a3e;
    }
    @keyframes pulse {
      from { transform: translate(-50%, -50%) scale(1); }
      to { transform: translate(-50%, -50%) scale(1.05); }
    }
    @keyframes levelUp {
      0% { transform: scale(1); background: rgba(0,0,0,0.7); }
      15% { transform: scale(1.5); background: rgba(255, 215, 0, 0.95); }
      30% { transform: scale(1.3); }
      50% { transform: scale(1.4); }
      70% { transform: scale(1.3); }
      100% { transform: scale(1.3); background: rgba(255, 215, 0, 0.9); }
    }
    @keyframes rotatePhone {
      0%, 100% { transform: rotate(0deg); }
      25% { transform: rotate(-15deg); }
      75% { transform: rotate(90deg); }
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <script type="text/babel">
    const { useState, useEffect, useCallback, useRef } = React;

    // Image mapping for player heads at each $10 interval
    const HEAD_IMAGES = {
      0: '1 - elf-game.png',      // $0-9
      1: '2 - henry-game.png',    // $10-19
      2: '3 - maggie-game.png',   // $20-29
      3: '4 - Kooper-game.png',   // $30-39
      4: '5 - fin-game.png',      // $40-49
      5: '6 - grace-game.png',    // $50-59
      6: '7 - ben-game.png',      // $60-69
      7: '8 - bobby-game.png',    // $70-79
      8: '9 - olivia-game.png',   // $80-89
      9: '10 - chase-game.png'    // $90-100
    };

    // Level names corresponding to each $10 interval
    const LEVEL_NAMES = {
      0: 'Elf',
      1: 'Henry',
      2: 'Maggie',
      3: 'Kooper',
      4: 'Fin',
      5: 'Grace',
      6: 'Ben',
      7: 'Bobby',
      8: 'Olivia',
      9: 'Chase'
    };

    const getHeadImage = (money, name) => {
      // Special characters have fixed head images
      if (name === 'Lebron') return 'lebron.png';
      if (name === 'T-Swift') return 't-swift.png';
      if (name === 'Khaleesi') return 'khaleesi.png';
      
      // Regular characters change based on level
      const index = Math.min(Math.floor(money / 10), 9);
      return HEAD_IMAGES[index];
    };

    const getLevelInfo = (money) => {
      const index = Math.min(Math.floor(money / 10), 9);
      return { level: index + 1, name: LEVEL_NAMES[index] };
    };

    // Get max earnings based on player name
    const getMaxEarnings = (name) => {
      const limitedPlayers = ['Henry', 'Maggie', 'Kooper', 'Finley', 'Grace', 'Ben', 'Bobby'];
      const mediumPlayers = ['Chase', 'Olivia'];
      
      if (limitedPlayers.includes(name)) {
        return 100;
      } else if (mediumPlayers.includes(name)) {
        return 250;
      }
      // Lebron, T-Swift, Khaleesi, and any future names have no limit
      return Infinity;
    };

    const ChristmasGame = () => {
      const [gameState, setGameState] = useState('start');
      const [playerName, setPlayerName] = useState('');
      const [money, setMoney] = useState(0);
      const [playerY, setPlayerY] = useState(50);
      const [items, setItems] = useState([]);
      const [backgroundOffset, setBackgroundOffset] = useState(0);
      const [grinchX, setGrinchX] = useState(100);
      const [snowflakes, setSnowflakes] = useState([]);
      const [touchDirection, setTouchDirection] = useState(null);
      const [levelUpAnimation, setLevelUpAnimation] = useState(false);
      const [currentLevel, setCurrentLevel] = useState(1);
      const [isLandscape, setIsLandscape] = useState(window.innerWidth > window.innerHeight);
      const gameLoopRef = useRef(null);
      const keysPressed = useRef({});
      const containerRef = useRef(null);

      const PLAYER_X = 10;

      // Orientation detection
      useEffect(() => {
        const checkOrientation = () => {
          setIsLandscape(window.innerWidth > window.innerHeight);
        };
        
        window.addEventListener('resize', checkOrientation);
        window.addEventListener('orientationchange', checkOrientation);
        
        return () => {
          window.removeEventListener('resize', checkOrientation);
          window.removeEventListener('orientationchange', checkOrientation);
        };
      }, []);

      // Auto-start game when landscape is detected in orientation check state
      useEffect(() => {
        if (gameState === 'orientationCheck' && isLandscape) {
          requestFullscreenAndStart();
        }
      }, [isLandscape, gameState]);

      const requestFullscreenAndStart = async () => {
        try {
          const elem = document.documentElement;
          if (elem.requestFullscreen) {
            await elem.requestFullscreen();
          } else if (elem.webkitRequestFullscreen) {
            await elem.webkitRequestFullscreen();
          } else if (elem.msRequestFullscreen) {
            await elem.msRequestFullscreen();
          }
        } catch (e) {
          // Fullscreen not supported or denied, continue anyway
        }
        setGameState('playing');
        setMoney(0);
        setItems([]);
        setPlayerY(50);
        setGrinchX(100);
        setCurrentLevel(1);
        setLevelUpAnimation(false);
      };

      useEffect(() => {
        const flakes = Array.from({ length: 40 }, (_, i) => ({
          id: i,
          x: Math.random() * 100,
          y: Math.random() * 100,
          size: Math.random() * 0.5 + 0.3,
          speed: Math.random() * 0.3 + 0.15
        }));
        setSnowflakes(flakes);
      }, []);

      const spawnItem = useCallback(() => {
        const level = Math.min(Math.floor(money / 10) + 1, 10);
        const rand = Math.random();
        
        // Determine coin value based on player
        const getCoinValue = () => {
          if (playerName === 'Chase' || playerName === 'Olivia') {
            return Math.random() > 0.5 ? 5 : 3;
          }
          return Math.random() > 0.5 ? 2 : 1;
        };
        
        // Increase reindeer frequency at higher levels
        let reindeerThreshold, snowmanThreshold;
        if (level >= 9) {
          // Level 9-10: 35% reindeer, 15% snowman, 50% coins
          reindeerThreshold = 0.35;
          snowmanThreshold = 0.50;
        } else if (level >= 6) {
          // Level 6-8: 30% reindeer, 15% snowman, 55% coins
          reindeerThreshold = 0.30;
          snowmanThreshold = 0.45;
        } else if (level >= 3) {
          // Level 3-5: 25% reindeer, 17% snowman, 58% coins
          reindeerThreshold = 0.25;
          snowmanThreshold = 0.42;
        } else {
          // Level 1-2: 20% reindeer, 20% snowman, 60% coins
          reindeerThreshold = 0.20;
          snowmanThreshold = 0.40;
        }
        
        if (rand > snowmanThreshold) {
          // Coin - can appear anywhere
          const coinValue = getCoinValue();
          return {
            id: Date.now() + Math.random(),
            x: 102,
            y: Math.random() * 70 + 10,
            type: 'coin',
            value: coinValue
          };
        } else if (rand > reindeerThreshold) {
          // Snowman - anchored to ground (lower portion of screen)
          return {
            id: Date.now() + Math.random(),
            x: 102,
            y: 68, // Fixed near ground level
            type: 'snowman',
            value: Math.floor(Math.random() * 8) + 3
          };
        } else {
          // Reindeer - in the air (upper portion of screen)
          return {
            id: Date.now() + Math.random(),
            x: 102,
            y: Math.random() * 40 + 10, // Upper half only
            type: 'reindeer',
            value: Math.floor(Math.random() * 8) + 3
          };
        }
      }, [money, playerName]);

      useEffect(() => {
        const handleKeyDown = (e) => {
          keysPressed.current[e.key] = true;
          if (['ArrowUp', 'ArrowDown', ' '].includes(e.key)) {
            e.preventDefault();
          }
        };
        const handleKeyUp = (e) => {
          keysPressed.current[e.key] = false;
        };

        window.addEventListener('keydown', handleKeyDown);
        window.addEventListener('keyup', handleKeyUp);

        return () => {
          window.removeEventListener('keydown', handleKeyDown);
          window.removeEventListener('keyup', handleKeyUp);
        };
      }, []);

      useEffect(() => {
        const container = containerRef.current;
        if (!container) return;

        const preventDefaults = (e) => {
          if (gameState === 'playing' || gameState === 'grinch') {
            e.preventDefault();
          }
        };

        container.addEventListener('touchmove', preventDefaults, { passive: false });
        container.addEventListener('touchstart', preventDefaults, { passive: false });

        return () => {
          container.removeEventListener('touchmove', preventDefaults);
          container.removeEventListener('touchstart', preventDefaults);
        };
      }, [gameState]);

      useEffect(() => {
        if (gameState !== 'playing' && gameState !== 'grinch') return;

        const gameLoop = setInterval(() => {
          const moveSpeed = 1.2;
          
          if (keysPressed.current['ArrowUp'] || keysPressed.current['w'] || touchDirection === 'up') {
            setPlayerY(y => Math.max(5, y - moveSpeed));
          }
          if (keysPressed.current['ArrowDown'] || keysPressed.current['s'] || touchDirection === 'down') {
            setPlayerY(y => Math.min(75, y + moveSpeed));
          }

          setBackgroundOffset(offset => (offset + 0.25) % 100);

          setSnowflakes(flakes => flakes.map(f => ({
            ...f,
            x: f.x - f.speed * 0.3,
            y: f.y + f.speed,
            ...(f.y > 100 ? { y: -2, x: Math.random() * 100 } : {}),
            ...(f.x < -2 ? { x: 102 } : {})
          })));

          if (Math.random() < 0.025 && gameState === 'playing') {
            setItems(items => [...items, spawnItem()]);
          }

          setItems(items => {
            const playerBox = { x: PLAYER_X, y: playerY, width: 10, height: 12 };
            
            return items
              .map(item => ({ ...item, x: item.x - 0.6 }))
              .filter(item => {
                const itemBox = { 
                  x: item.x, 
                  y: item.y, 
                  width: item.type === 'coin' ? 6 : 7, 
                  height: item.type === 'coin' ? 6 : (item.type === 'snowman' ? 12 : 6)
                };

                const collision = 
                  playerBox.x < itemBox.x + itemBox.width &&
                  playerBox.x + playerBox.width > itemBox.x &&
                  playerBox.y < itemBox.y + itemBox.height &&
                  playerBox.y + playerBox.height > itemBox.y;

                if (collision) {
                  if (item.type === 'coin') {
                    const maxEarnings = getMaxEarnings(playerName);
                    setMoney(m => Math.min(maxEarnings, m + item.value));
                  } else {
                    setMoney(m => Math.max(0, m - item.value));
                  }
                  return false;
                }

                return item.x > -10;
              });
          });

          setMoney(m => {
            const maxEarnings = getMaxEarnings(playerName);
            if (m >= maxEarnings && maxEarnings !== Infinity && gameState === 'playing') {
              setGameState('grinch');
            }
            return m;
          });

        }, 1000 / 60);

        gameLoopRef.current = gameLoop;
        return () => clearInterval(gameLoop);
      }, [gameState, playerY, touchDirection, spawnItem]);

      useEffect(() => {
        if (gameState !== 'grinch') return;

        const grinchLoop = setInterval(() => {
          setGrinchX(x => {
            if (x <= 35) {
              clearInterval(grinchLoop);
              setTimeout(() => setGameState('won'), 2000);
              return 35;
            }
            return x - 1;
          });
        }, 1000 / 60);

        return () => clearInterval(grinchLoop);
      }, [gameState]);

      // Detect level changes and trigger animation only for level UP (not for special characters)
      useEffect(() => {
        // Special characters don't have level changes
        if (['Lebron', 'T-Swift', 'Khaleesi'].includes(playerName)) return;
        
        const newLevel = Math.min(Math.floor(money / 10) + 1, 10);
        if (newLevel > currentLevel && money > 0) {
          setCurrentLevel(newLevel);
          setLevelUpAnimation(true);
          setTimeout(() => setLevelUpAnimation(false), 1500);
        } else if (newLevel < currentLevel) {
          // Level went down, update without animation
          setCurrentLevel(newLevel);
        }
      }, [money, currentLevel, playerName]);

      const startGame = () => {
        if (playerName.trim()) {
          // Check if already in landscape
          if (window.innerWidth > window.innerHeight) {
            requestFullscreenAndStart();
          } else {
            setGameState('orientationCheck');
          }
        }
      };

      const resetGame = () => {
        setGameState('start');
        setPlayerName('');
        setMoney(0);
        setItems([]);
        setPlayerY(50);
        setGrinchX(100);
        setCurrentLevel(1);
        setLevelUpAnimation(false);
      };

      const handleTouchStart = (direction) => {
        setTouchDirection(direction);
      };

      const handleTouchEnd = () => {
        setTouchDirection(null);
      };

      const renderMountains = (offset, color, speed, height) => {
        const adjustedOffset = (offset * speed) % 25;
        return (
          <g>
            {[-1, 0, 1, 2, 3, 4, 5, 6, 7, 8].map(i => (
              <polygon
                key={i}
                points={`${i * 25 - adjustedOffset},100 ${i * 25 + 12.5 - adjustedOffset},${100 - height} ${i * 25 + 25 - adjustedOffset},100`}
                fill={color}
              />
            ))}
          </g>
        );
      };

      const renderTrees = (offset) => {
        const adjustedOffset = (offset * 1.5) % 18;
        return (
          <g>
            {[-1, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12].map(i => (
              <g key={i} transform={`translate(${i * 18 - adjustedOffset}, 0)`}>
                <polygon points="6,76 9,64 12,76" fill="#0d5c0d" />
                <polygon points="6,68 9,56 12,68" fill="#0f6b0f" />
                <polygon points="6,60 9,48 12,60" fill="#117a11" />
                <rect x="8" y="76" width="2" height="4" fill="#4a3728" />
              </g>
            ))}
          </g>
        );
      };

      const containerStyle = {
        width: '100vw',
        height: '100vh',
        maxWidth: '100%',
        maxHeight: '100%',
        margin: '0 auto',
        position: 'relative',
        overflow: 'hidden',
        touchAction: 'none',
        userSelect: 'none',
        WebkitUserSelect: 'none',
        WebkitTouchCallout: 'none'
      };

      if (gameState === 'start') {
        return (
          <div ref={containerRef} style={{
            ...containerStyle,
            background: 'linear-gradient(to bottom, #1a1a3e 0%, #2d1b4e 50%, #1a472a 100%)',
            display: 'flex',
            flexDirection: 'column',
            alignItems: 'center',
            justifyContent: 'center',
            fontFamily: 'Georgia, serif'
          }}>
            <svg style={{ position: 'absolute', top: 0, left: 0, width: '100%', height: '100%', pointerEvents: 'none' }} viewBox="0 0 100 100" preserveAspectRatio="none">
              {snowflakes.map(f => (
                <circle key={f.id} cx={f.x} cy={f.y} r={f.size} fill="white" opacity="0.8" />
              ))}
            </svg>
            
            <h1 style={{ 
              color: '#ff6b6b', 
              fontSize: 'clamp(24px, 6vw, 48px)', 
              textShadow: '3px 3px 0 #2d5a27, -1px -1px 0 #fff',
              marginBottom: '2vh',
              zIndex: 1,
              textAlign: 'center',
              padding: '0 10px'
            }}>
              Christmas Dash!
            </h1>
            
            <p style={{ 
              color: '#90EE90', 
              fontSize: 'clamp(14px, 3vw, 18px)', 
              marginBottom: '3vh', 
              zIndex: 1,
              textAlign: 'center',
              padding: '0 10px'
            }}>
              Collect coins to increase your Christmas cash!
            </p>
            
            <div style={{ 
              background: 'rgba(255,255,255,0.95)', 
              padding: 'clamp(15px, 3vw, 30px)', 
              borderRadius: '15px',
              boxShadow: '0 4px 15px rgba(0,0,0,0.3)',
              zIndex: 1,
              width: '90%',
              maxWidth: '400px'
            }}>
              <label style={{ 
                display: 'block', 
                marginBottom: '15px', 
                color: '#2d5a27', 
                fontWeight: 'bold',
                fontSize: 'clamp(14px, 2.5vw, 18px)',
                textAlign: 'center'
              }}>
                Choose Your Name:
              </label>
              <select
                value={playerName}
                onChange={(e) => setPlayerName(e.target.value)}
                style={{
                  padding: 'clamp(12px, 2vw, 18px)',
                  fontSize: 'clamp(16px, 3vw, 22px)',
                  borderRadius: '8px',
                  border: '3px solid #c41e3a',
                  marginBottom: '20px',
                  width: '100%',
                  boxSizing: 'border-box',
                  outline: 'none',
                  background: 'white',
                  cursor: 'pointer',
                  appearance: 'none',
                  backgroundImage: 'url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 24 24\' fill=\'none\' stroke=\'%23c41e3a\' stroke-width=\'2\' stroke-linecap=\'round\' stroke-linejoin=\'round\'%3e%3cpolyline points=\'6 9 12 15 18 9\'%3e%3c/polyline%3e%3c/svg%3e")',
                  backgroundRepeat: 'no-repeat',
                  backgroundPosition: 'right 12px center',
                  backgroundSize: '20px'
                }}
              >
                <option value="">-- Select your name --</option>
                {['Henry', 'Maggie', 'Kooper', 'Finley', 'Grace', 'Ben', 'Bobby', 'Olivia', 'Chase', 'Lebron', 'T-Swift', 'Khaleesi'].map(name => (
                  <option key={name} value={name}>{name}</option>
                ))}
              </select>
              <button
                onClick={startGame}
                disabled={!playerName}
                style={{
                  padding: 'clamp(12px, 2.5vw, 18px) clamp(30px, 5vw, 50px)',
                  fontSize: 'clamp(18px, 3vw, 24px)',
                  background: playerName 
                    ? 'linear-gradient(to bottom, #c41e3a, #8b0000)' 
                    : 'linear-gradient(to bottom, #999, #777)',
                  color: 'white',
                  border: 'none',
                  borderRadius: '10px',
                  cursor: playerName ? 'pointer' : 'not-allowed',
                  fontWeight: 'bold',
                  boxShadow: playerName ? '0 4px 0 #5c0000' : '0 4px 0 #555',
                  width: '100%',
                  opacity: playerName ? 1 : 0.7
                }}
              >
                Start Game!
              </button>
            </div>
            
            <p style={{ 
              color: '#fff', 
              marginTop: '3vh', 
              fontSize: 'clamp(12px, 2vw, 14px)', 
              zIndex: 1,
              textAlign: 'center'
            }}>
              Tap left side to go UP, right side to go DOWN
            </p>
          </div>
        );
      }

      // Orientation check screen
      if (gameState === 'orientationCheck') {
        return (
          <div ref={containerRef} style={{
            ...containerStyle,
            background: 'linear-gradient(to bottom, #1a1a3e 0%, #2d1b4e 50%, #1a472a 100%)',
            display: 'flex',
            flexDirection: 'column',
            alignItems: 'center',
            justifyContent: 'center',
            fontFamily: 'Georgia, serif'
          }}>
            <svg style={{ position: 'absolute', top: 0, left: 0, width: '100%', height: '100%', pointerEvents: 'none' }} viewBox="0 0 100 100" preserveAspectRatio="none">
              {snowflakes.map(f => (
                <circle key={f.id} cx={f.x} cy={f.y} r={f.size} fill="white" opacity="0.8" />
              ))}
            </svg>
            
            <h2 style={{ 
              color: '#ffd700', 
              fontSize: 'clamp(20px, 5vw, 36px)', 
              textShadow: '2px 2px 4px #000',
              marginBottom: '3vh',
              zIndex: 1,
              textAlign: 'center',
              padding: '0 20px'
            }}>
              Rotate Your Phone!
            </h2>
            
            {/* Rotating phone icon */}
            <div style={{
              zIndex: 1,
              marginBottom: '3vh'
            }}>
              <svg width="120" height="120" viewBox="0 0 120 120" style={{ animation: 'rotatePhone 2s ease-in-out infinite' }}>
                {/* Phone body */}
                <rect x="35" y="20" width="50" height="80" rx="8" fill="#333" stroke="#666" strokeWidth="2" />
                {/* Screen */}
                <rect x="40" y="28" width="40" height="60" fill="#1a3a5c" />
                {/* Home button */}
                <circle cx="60" cy="94" r="4" fill="#555" />
                {/* Rotation arrow */}
                <path d="M 15 60 A 45 45 0 0 1 60 15" stroke="#ffd700" strokeWidth="4" fill="none" strokeLinecap="round" />
                <polygon points="60,5 60,25 75,15" fill="#ffd700" />
              </svg>
            </div>
            
            <p style={{ 
              color: '#90EE90', 
              fontSize: 'clamp(14px, 3vw, 18px)', 
              zIndex: 1,
              textAlign: 'center',
              padding: '0 20px'
            }}>
              Turn your phone sideways for the best experience
            </p>
            
            <p style={{ 
              color: '#aaa', 
              fontSize: 'clamp(12px, 2vw, 14px)', 
              marginTop: '2vh',
              zIndex: 1,
              textAlign: 'center'
            }}>
              Game will start automatically...
            </p>
            
            <button
              onClick={requestFullscreenAndStart}
              style={{
                marginTop: '3vh',
                padding: 'clamp(8px, 1.5vw, 12px) clamp(20px, 3vw, 30px)',
                fontSize: 'clamp(12px, 2vw, 16px)',
                background: 'transparent',
                color: '#aaa',
                border: '1px solid #666',
                borderRadius: '8px',
                cursor: 'pointer',
                zIndex: 1
              }}
            >
              Skip (already landscape)
            </button>
          </div>
        );
      }

      if (gameState === 'won') {
        return (
          <div ref={containerRef} style={{
            ...containerStyle,
            background: 'linear-gradient(to bottom, #1a472a, #2d5a27)',
            display: 'flex',
            flexDirection: 'column',
            alignItems: 'center',
            justifyContent: 'center',
            fontFamily: 'Georgia, serif'
          }}>
            <h1 style={{ 
              color: '#ffd700', 
              fontSize: 'clamp(24px, 5vw, 42px)', 
              textShadow: '2px 2px 4px #000',
              marginBottom: '2vh',
              textAlign: 'center',
              padding: '0 10px'
            }}>
              Congratulations, {playerName}!
            </h1>
            
            <div style={{ fontSize: 'clamp(40px, 10vw, 80px)', marginBottom: '2vh' }}>üéÑüéÅüéÖ</div>
            
            <p style={{ 
              color: '#fff', 
              fontSize: 'clamp(18px, 4vw, 28px)', 
              marginBottom: '1vh' 
            }}>
              You earned <span style={{ color: '#90EE90', fontWeight: 'bold' }}>${money}</span>!
            </p>
            
            <p style={{ 
              color: '#ff6b6b', 
              fontSize: 'clamp(12px, 2.5vw, 18px)', 
              marginBottom: '3vh',
              textAlign: 'center',
              padding: '0 20px'
            }}>
              The Grinch stopped you from earning more... but ${getMaxEarnings(playerName)} is the max anyway!
            </p>
            
            <button
              onClick={resetGame}
              style={{
                padding: 'clamp(12px, 2.5vw, 18px) clamp(30px, 5vw, 50px)',
                fontSize: 'clamp(18px, 3vw, 24px)',
                background: 'linear-gradient(to bottom, #c41e3a, #8b0000)',
                color: 'white',
                border: 'none',
                borderRadius: '10px',
                cursor: 'pointer',
                fontWeight: 'bold',
                boxShadow: '0 4px 0 #5c0000'
              }}
            >
              Play Again!
            </button>
          </div>
        );
      }

      return (
        <div ref={containerRef} style={containerStyle}>
          <svg 
            width="100%" 
            height="100%" 
            viewBox="0 0 100 100" 
            preserveAspectRatio="xMidYMid slice"
            style={{ display: 'block', position: 'absolute', top: 0, left: 0 }}
          >
            <defs>
              <linearGradient id="skyGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                <stop offset="0%" stopColor="#1a3a5c" />
                <stop offset="50%" stopColor="#3a6a8c" />
                <stop offset="100%" stopColor="#5a8aac" />
              </linearGradient>
              <clipPath id="headClip">
                <circle cx="3.5" cy="4" r="2.2" />
              </clipPath>
            </defs>
            <rect width="100" height="100" fill="url(#skyGradient)" />

            {[...Array(20)].map((_, i) => (
              <circle
                key={`star-${i}`}
                cx={(i * 9.1 + backgroundOffset * 0.1) % 100}
                cy={(i * 4.6) % 25}
                r={0.3}
                fill="white"
                opacity={0.7}
              />
            ))}

            <circle cx={88} cy={12} r={4} fill="#fffacd" />
            <circle cx={89} cy={11} r={3.5} fill="#0a1628" />

            {renderMountains(backgroundOffset, '#1a3a4a', 0.3, 20)}
            {renderMountains(backgroundOffset, '#2d4a5a', 0.6, 16)}
            {renderMountains(backgroundOffset, '#3d5a6a', 1, 12)}
            {renderTrees(backgroundOffset)}

            <rect x="0" y="80" width="100" height="20" fill="#f0f8ff" />
            <rect x="0" y="80" width="100" height="2" fill="#e8f4f8" />

            {snowflakes.map(f => (
              <circle key={f.id} cx={f.x} cy={f.y} r={f.size} fill="white" opacity="0.8" />
            ))}

            {/* Player Vehicle */}
            {playerName === 'Khaleesi' ? (
              /* Dragon for Khaleesi */
              <g transform={`translate(${PLAYER_X}, ${playerY})`}>
                {/* Dragon body */}
                <ellipse cx="5" cy="6" rx="6" ry="3" fill="#1a1a1a" />
                {/* Dragon tail */}
                <path d="M -1 6 Q -4 4 -6 6 Q -5 5 -4 6 Q -5 7 -6 6" fill="#1a1a1a" />
                <polygon points="-6,5 -8,4 -6,6" fill="#1a1a1a" />
                {/* Dragon neck */}
                <path d="M 10 5 Q 12 3 13 4" stroke="#1a1a1a" strokeWidth="2" fill="none" />
                {/* Dragon head */}
                <ellipse cx="14" cy="3.5" rx="2" ry="1.5" fill="#1a1a1a" />
                {/* Dragon eye */}
                <circle cx="14.8" cy="3" r="0.4" fill="#ff4500" />
                {/* Dragon horns */}
                <path d="M 13 2.5 L 12 1 M 14 2 L 13.5 0.5" stroke="#333" strokeWidth="0.4" fill="none" />
                {/* Dragon nostrils - fire */}
                <circle cx="15.8" cy="3.5" r="0.3" fill="#ff4500" />
                {/* Dragon wings */}
                <path d="M 3 4 Q 0 -2 5 0 Q 3 2 6 3" fill="#2a2a2a" />
                <path d="M 5 4 Q 3 -1 8 1 Q 5 2 7 3" fill="#222" />
                {/* Dragon legs */}
                <path d="M 2 8 L 1 10 L 2 10 L 2.5 9" fill="#1a1a1a" />
                <path d="M 7 8 L 7 10 L 8 10 L 8.5 9" fill="#1a1a1a" />
                
                {/* Khaleesi riding */}
                <ellipse cx="5" cy="4" rx="1.5" ry="1.2" fill="#e0e0e0" />
                
                {/* Character head - image */}
                <clipPath id="playerHeadClip">
                  <circle cx="5" cy="2" r="2" />
                </clipPath>
                <image 
                  href={getHeadImage(money, playerName)}
                  x="2.5" 
                  y="-0.5" 
                  width="5" 
                  height="5" 
                  clipPath="url(#playerHeadClip)"
                  preserveAspectRatio="xMidYMid slice"
                />
                
                {/* Level name on dragon */}
                <text 
                  x="5" 
                  y="7" 
                  textAnchor="middle" 
                  fill="white" 
                  fontSize="1.4" 
                  fontWeight="bold"
                  fontFamily="Georgia, serif"
                >
                  Khaleesi
                </text>
              </g>
            ) : (
              /* Sleigh for everyone else */
              <g transform={`translate(${PLAYER_X}, ${playerY})`}>
                {/* Sleigh body */}
                <ellipse cx="4" cy="7" rx="5" ry="1.8" fill="#8b0000" />
                <ellipse cx="4" cy="7" rx="4" ry="1.2" fill="#c41e3a" />
                <path d="M 0 7 Q -0.5 4 1.5 3 L 2 6 Z" fill="#8b0000" />
                <path d="M -0.5 9 Q 0 10 8 10 Q 9 9.5 8.5 9" stroke="#ffd700" strokeWidth="0.5" fill="none" />
                
                {/* Character body */}
                <ellipse cx="3.5" cy="6" rx="2" ry="1.5" fill="#c41e3a" />
                
                {/* Character head - now an image */}
                <clipPath id="playerHeadClip">
                  <circle cx="3.5" cy="3.5" r="2.5" />
                </clipPath>
                <image 
                  href={getHeadImage(money, playerName)}
                  x="0.5" 
                  y="0.5" 
                  width="6" 
                  height="6" 
                  clipPath="url(#playerHeadClip)"
                  preserveAspectRatio="xMidYMid slice"
                />
                
                {/* Santa hat on top of head */}
                <path d="M 1.5 2 Q 3.5 -1 6 2" fill="#c41e3a" />
                <circle cx="6" cy="1.5" r="0.8" fill="white" />
                <ellipse cx="3.5" cy="2.2" rx="2.2" ry="0.5" fill="white" />
                
                {/* Level name on sleigh - rendered last to be on top */}
                <text 
                  x="4" 
                  y="7.5" 
                  textAnchor="middle" 
                  fill="white" 
                  fontSize="1.4" 
                  fontWeight="bold"
                  fontFamily="Georgia, serif"
                >
                  {['Lebron', 'T-Swift', 'Khaleesi'].includes(playerName) ? playerName : getLevelInfo(money).name}
                </text>
              </g>
            )}

            {items.map(item => (
              <g key={item.id} transform={`translate(${item.x}, ${item.y})`}>
                {item.type === 'coin' ? (
                  <g>
                    {/* Silver for $1/$3, Gold for $2/$5 */}
                    <circle cx="2.5" cy="3" r="2.5" fill={item.value === 1 || item.value === 3 ? '#c0c0c0' : '#ffd700'} stroke={item.value === 1 || item.value === 3 ? '#a0a0a0' : '#daa520'} strokeWidth="0.3" />
                    <circle cx="2.5" cy="3" r="1.8" fill="none" stroke="#fff" strokeWidth="0.15" opacity="0.5" />
                    <rect x="2" y="0" width="1" height="1.2" fill="#888" />
                    <circle cx="2.5" cy="0.6" r="0.6" fill="#888" stroke="#666" strokeWidth="0.15" />
                    <text x="2.5" y="3.7" textAnchor="middle" fill={item.value === 1 || item.value === 3 ? '#444' : '#8b4513'} fontSize="2.2" fontWeight="bold">${item.value}</text>
                  </g>
                ) : item.type === 'snowman' ? (
                  <g>
                    {/* Snowman - anchored to ground */}
                    <circle cx="3" cy="8" r="3" fill="#fff" stroke="#ddd" strokeWidth="0.15" />
                    <circle cx="3" cy="3" r="2.2" fill="#fff" stroke="#ddd" strokeWidth="0.15" />
                    <circle cx="2.2" cy="2.5" r="0.35" fill="#000" />
                    <circle cx="3.8" cy="2.5" r="0.35" fill="#000" />
                    <polygon points="3,3.2 3,4 4.2,3.6" fill="#ff6600" />
                    <circle cx="3" cy="6.5" r="0.35" fill="#333" />
                    <circle cx="3" cy="8" r="0.35" fill="#333" />
                    <circle cx="3" cy="9.5" r="0.35" fill="#333" />
                    <line x1="-0.5" y1="6" x2="2" y2="5" stroke="#8b4513" strokeWidth="0.5" />
                    <line x1="6.5" y1="6" x2="4" y2="5" stroke="#8b4513" strokeWidth="0.5" />
                    {/* Top hat */}
                    <rect x="1.5" y="-0.5" width="3" height="0.6" fill="#222" />
                    <rect x="2" y="-2.5" width="2" height="2" fill="#222" />
                  </g>
                ) : (
                  <g>
                    {/* Reindeer - flying in air, facing left */}
                    {/* Body */}
                    <ellipse cx="6" cy="4" rx="4" ry="2.5" fill="#8B4513" />
                    {/* Head */}
                    <ellipse cx="1.5" cy="3" rx="1.8" ry="1.5" fill="#8B4513" />
                    {/* Antlers */}
                    <path d="M 2 1.5 L 2.5 -0.5 L 3.5 0 M 2.5 -0.5 L 3 -1.5" stroke="#5D3A1A" strokeWidth="0.4" fill="none" />
                    <path d="M 1 1.5 L 0.5 -0.5 L -0.5 0 M 0.5 -0.5 L 0 -1.5" stroke="#5D3A1A" strokeWidth="0.4" fill="none" />
                    {/* Red nose */}
                    <circle cx="-0.2" cy="3" r="0.6" fill="#ff0000" />
                    {/* Eye */}
                    <circle cx="1.2" cy="2.5" r="0.35" fill="#000" />
                    {/* Legs */}
                    <line x1="4" y1="6" x2="4" y2="8" stroke="#5D3A1A" strokeWidth="0.5" />
                    <line x1="6" y1="6" x2="6" y2="8" stroke="#5D3A1A" strokeWidth="0.5" />
                    <line x1="8" y1="6" x2="8.5" y2="8" stroke="#5D3A1A" strokeWidth="0.5" />
                    {/* Tail */}
                    <ellipse cx="10" cy="4" rx="0.8" ry="0.5" fill="#5D3A1A" />
                  </g>
                )}
              </g>
            ))}

            {gameState === 'grinch' && (
              <g transform={`translate(${grinchX}, 25)`}>
                <ellipse cx="8" cy="45" rx="7" ry="10" fill="#4a7c23" />
                <ellipse cx="8" cy="20" rx="6" ry="7" fill="#4a7c23" />
                <ellipse cx="6" cy="18" rx="1.2" ry="1.5" fill="#fff" />
                <ellipse cx="10" cy="18" rx="1.2" ry="1.5" fill="#fff" />
                <circle cx="6.3" cy="18.3" r="0.6" fill="#8b0000" />
                <circle cx="10.3" cy="18.3" r="0.6" fill="#8b0000" />
                <path d="M 4 26 Q 8 30 12 26" stroke="#1a4010" strokeWidth="0.6" fill="none" />
                <path d="M 3 14 Q 8 6 14 12" fill="#c41e3a" />
                <ellipse cx="8" cy="13" rx="6" ry="1.8" fill="white" />
                <circle cx="14" cy="11" r="1.5" fill="white" />
                <path d="M 1 38 Q -2 28 -1 22" stroke="#4a7c23" strokeWidth="3" fill="none" strokeLinecap="round" />
                <path d="M 15 38 Q 18 28 17 22" stroke="#4a7c23" strokeWidth="3" fill="none" strokeLinecap="round" />
              </g>
            )}
          </svg>

          {(gameState === 'playing' || gameState === 'grinch') && (
            <>
              <div
                onTouchStart={() => handleTouchStart('up')}
                onTouchEnd={handleTouchEnd}
                onMouseDown={() => handleTouchStart('up')}
                onMouseUp={handleTouchEnd}
                onMouseLeave={handleTouchEnd}
                style={{
                  position: 'absolute',
                  left: 0,
                  top: 0,
                  width: '50%',
                  height: '100%',
                  background: touchDirection === 'up' ? 'rgba(255,255,255,0.1)' : 'transparent',
                  zIndex: 10,
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center'
                }}
              >
                <div style={{
                  color: 'rgba(255,255,255,0.3)',
                  fontSize: 'clamp(24px, 8vw, 48px)',
                  pointerEvents: 'none'
                }}>
                  ‚ñ≤
                </div>
              </div>
              
              <div
                onTouchStart={() => handleTouchStart('down')}
                onTouchEnd={handleTouchEnd}
                onMouseDown={() => handleTouchStart('down')}
                onMouseUp={handleTouchEnd}
                onMouseLeave={handleTouchEnd}
                style={{
                  position: 'absolute',
                  right: 0,
                  top: 0,
                  width: '50%',
                  height: '100%',
                  background: touchDirection === 'down' ? 'rgba(255,255,255,0.1)' : 'transparent',
                  zIndex: 10,
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center'
                }}
              >
                <div style={{
                  color: 'rgba(255,255,255,0.3)',
                  fontSize: 'clamp(24px, 8vw, 48px)',
                  pointerEvents: 'none'
                }}>
                  ‚ñº
                </div>
              </div>
            </>
          )}

          <div style={{
            position: 'absolute',
            top: '2%',
            left: '2%',
            background: 'rgba(0,0,0,0.7)',
            padding: 'clamp(5px, 1.5vw, 12px) clamp(10px, 2vw, 20px)',
            borderRadius: '10px',
            color: 'white',
            fontFamily: 'Georgia, serif',
            zIndex: 20
          }}>
            <div style={{ fontSize: 'clamp(12px, 2.5vw, 18px)', fontWeight: 'bold' }}>{playerName}</div>
            <div style={{ fontSize: 'clamp(20px, 4vw, 32px)', color: '#90EE90' }}>${money}</div>
          </div>

          {/* Level indicator - upper right */}
          <div style={{
            position: 'absolute',
            top: '2%',
            right: '2%',
            background: (levelUpAnimation && !['Lebron', 'T-Swift', 'Khaleesi'].includes(playerName)) ? 'rgba(255, 215, 0, 0.9)' : 'rgba(0,0,0,0.7)',
            padding: 'clamp(5px, 1.5vw, 12px) clamp(15px, 2.5vw, 25px)',
            borderRadius: '10px',
            color: (levelUpAnimation && !['Lebron', 'T-Swift', 'Khaleesi'].includes(playerName)) ? '#000' : 'white',
            fontFamily: 'Georgia, serif',
            zIndex: 25,
            textAlign: 'center',
            transformOrigin: 'top right',
            animation: (levelUpAnimation && !['Lebron', 'T-Swift', 'Khaleesi'].includes(playerName)) ? 'levelUp 0.5s ease-out forwards' : 'none',
            boxShadow: (levelUpAnimation && !['Lebron', 'T-Swift', 'Khaleesi'].includes(playerName)) ? '0 0 40px 15px rgba(255, 215, 0, 0.8)' : 'none'
          }}>
            <div style={{ fontSize: levelUpAnimation ? 'clamp(18px, 4vw, 28px)' : 'clamp(14px, 3vw, 22px)', fontWeight: 'bold' }}>
              {['Lebron', 'T-Swift', 'Khaleesi'].includes(playerName) 
                ? <span style={{ color: '#ffd700' }}>{playerName}</span>
                : (levelUpAnimation 
                    ? <>New Level Achieved: <span style={{ color: '#8b0000' }}>{getLevelInfo(money).name}</span></>
                    : <>Level {getLevelInfo(money).level}: <span style={{ color: '#ffd700' }}>{getLevelInfo(money).name}</span></>
                  )
              }
            </div>
          </div>

          {gameState === 'grinch' && (
            <div style={{
              position: 'absolute',
              top: '50%',
              left: '50%',
              transform: 'translate(-50%, -50%)',
              background: 'rgba(139, 0, 0, 0.95)',
              padding: 'clamp(10px, 3vw, 25px) clamp(20px, 5vw, 45px)',
              borderRadius: '15px',
              color: 'white',
              fontSize: 'clamp(16px, 4vw, 28px)',
              fontWeight: 'bold',
              fontFamily: 'Georgia, serif',
              textAlign: 'center',
              zIndex: 30,
              animation: 'pulse 0.5s infinite alternate'
            }}>
              THE GRINCH IS COMING!
              <div style={{ fontSize: 'clamp(10px, 2vw, 16px)', marginTop: '8px' }}>
                He will not let you earn more than $100!
              </div>
            </div>
          )}
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<ChristmasGame />);
  </script>
</body>
</html>
